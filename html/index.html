<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>core_arena: README for the core_arena library.</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">core_arena
   &#160;<span id="projectnumber">v0.0.1</span>
   </div>
   <div id="projectbrief">An arena allocater that uses core memory aside malloc.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">README for the core_arena library. </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md_README"></a></p>
<h1><a class="anchor" id="autotoc_md0"></a>
Installation</h1>
<p>Both the include file <b><a class="el" href="a00008.html" title="A general purpose arena strategy that is based on malloc - header file.">core_arena.h</a></b> and the source file <b><a class="el" href="a00005.html" title="A general purpose arena strategy that is based on malloc.">core_arena.c</a></b> should be installed into your project and you should change the path to the include file into something more fitting if you want to store it apart from <b><a class="el" href="a00005.html" title="A general purpose arena strategy that is based on malloc.">core_arena.c</a></b>.</p>
<p>You can then compile it with your project like your would with any other module.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Configuration in core_arena.h:</h1>
<p>The constants <b>MAX_ALIGN</b> and <b>MALLOC_PTR_SIZE</b> might need to be recallibrated if you aren't on a Linux x86-64 system. You may want to change the constant <b>ARENAS_MAX</b> defines the number of arenas you intend to use, this can't be altered run-time.</p>
<p>The <b>MAX_ALIGN</b> constant denotes the alignment that is used to access memory efficiently.</p>
<p>The <b>MALLOC_PTR_SIZE</b> denotes the pointers size <code>malloc()</code> willl use for itself in the allocated block.</p>
<p>The <b>ARENAS_MAX</b> is originally configured for two Arenas, (the index of the arenas starts at <code>0</code>).</p>
<ul>
<li>Specify the number of arenas your intend to use in <code><a class="el" href="a00008.html" title="A general purpose arena strategy that is based on malloc - header file.">core_arena.h</a></code>.</li>
</ul>
<h2><a class="anchor" id="autotoc_md2"></a>
Configuring logging.</h2>
<p>We support logging, so you can deduce the memory usage, the logging is only intended for testing, and not to be left on in production code.</p>
<p>The <b>ARENAS_LOG_LEVEL</b> can be defined to <b>NONE</b>, <b>CHUNKS</b>, and <b>EVERYTHING</b>. <b>NONE</b> means there will be no logging, if <b>CHUNKS</b> is specified, then the number of chunks allocated during the lifetime of the arena will be reported. If you use an arena, later destroy it, only to create it a second time, then it is the number from the second usage that is reported. If <b>EVERYTHING</b> is specified, then the total bytes allocated from the chunks are reported too.</p>
<h1><a class="anchor" id="autotoc_md3"></a>
Usage Overview</h1>
<h2><a class="anchor" id="autotoc_md4"></a>
Configuring the arena.</h2>
<ul>
<li>Include <code><a class="el" href="a00008.html" title="A general purpose arena strategy that is based on malloc - header file.">core_arena.h</a></code> in any source file you intend to use arena allocation from.</li>
<li>You must call <code>arena_create(n,chunk_sz)</code> before using the arena.</li>
</ul>
<h3><a class="anchor" id="autotoc_md5"></a>
Parameter  explanation:</h3>
<p><code>n</code> is the number of the arena you configure, with which you will reference the arena when using the other calls.</p>
<p>The chunk_sz you specify is the size of memory that will be handled out during individual <code>arena_alloc/arena_calloc</code> calls. Every arena needs a struct for book keeping,and malloc needs some bytes for book-keeping too. The necessary bytes for book-keeping are subtracted from the specified chunk_sz. I recommend a chunk_sz of a multiple/part of <b>4096</b> (the page size on a Linux platform).</p>
<p><b>2048</b>, <b>1024</b>, <b>512</b>, <b>256</b>, <b>128</b>, are examples of good fractions of <b>4096</b>. <b>3072</b>, <b>1536</b>, <b>384</b>, and so on, are also good numbers when you known the total number of bytes you need and want to cap the bufsize.</p>
<p>If you are on a different platform than Linux, you should determine what the pagesize is on your system and use that number of bytes as a vantage point for specifying the chunk size.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Getting memory from the arena into your program.</h2>
<p>You allocate memory for an object in memory with: <code>void *arena_alloc</code>. and memory for a zeroed out array with: <code>void *arena_calloc</code>.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Ending/deallocating an arena.</h2>
<p>When the collective lifetime for the objects of the arena is over you can delete them with <code>arena_dealloc</code> and retain the memory for reuse with the same arena in another lifetime, or your can call <code>arena_destroy</code>, and return the memory back to the operating system.</p>
<h2><a class="anchor" id="autotoc_md8"></a>
Beware.</h2>
<p>No calls like <code>free</code> or <code>realloc</code> from <code>stdlib.h</code> will work on pointers to memory returned by the <code>arena_*</code> functions, but most likely generate a segment violation (<code>SIG_SEGV</code>) error.</p>
<p>Even if the logging arrays are defined as <code>long long</code> I recommend you turn logging off in production code, because at some time, there will be either an overflow or wraparound, rendering the numbers useless anyway. The logging report is bypassed if you exit your program with <code>_Exit</code> or a <code>TERM</code> signal, as the report_usage is installed by <code>atexit()</code>.</p>
<hr  />
<p> Last updated:23-12-29 21:05 </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Dec 29 2023 22:09:40 for core_arena by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
